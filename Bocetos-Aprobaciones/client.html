<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aprobación de bocetos | Merchi</title>
<style>
:root{--bg:#f6f7f9;--card:#fff;--ink:#111;--muted:#666;--bd:#e6e8ec;--brand:#0b53d0}
*{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:Arial,system-ui,sans-serif;color:var(--ink)}
.wrap{max-width:900px;margin:0 auto;padding:20px}
.card{background:var(--card);border:1px solid var(--bd);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:18px;margin-bottom:14px}
h1{font-size:22px;margin:0 0 8px} h2{font-size:18px;margin:12px 0 8px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#1e40af;font-size:12px}
.btn{display:inline-block;border:none;background:var(--brand);color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.outline{background:#fff;color:var(--brand);border:1px solid var(--brand)}
label{font-size:14px;color:var(--muted)}
textarea{width:100%;min-height:100px;padding:10px;border:1px solid var(--bd);border-radius:10px}
input[type=file]{display:block;margin-top:6px}
.table{border-collapse:collapse;width:100%}
.table th,.table td{border:1px solid #eee;padding:8px}
.table thead th{background:#f1f5ff}
.small{font-size:12px;color:var(--muted)}
.kv{font-size:14px;color:#333}
.kv b{color:#111}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Revisión de bocetos</h1>
    <div class="small">
      Pedido <b><?= pedido.nro ?></b> · Empresa <b><?= pedido.empresa ?></b> · Versión <b>v<?= pedido.version ?></b> ·
      <span class="badge"><?= pedido.estado ?></span>
    </div>
  </div>

  <div class="card">
    <h2>Detalle del pedido</h2>
    <div class="kv">
      <? if (pedido.cotnum) { ?><div><b>Nº Cotización:</b> <?= pedido.cotnum ?></div><? } ?>
      <div><b>Monto total (referencia):</b> <?= pedido.monto || '—' ?></div>
      <div><b>Pago:</b> <?= (pedido.pago.cond || '—') ?><? if (pedido.pago.cond==='Personalizado' && pedido.pago.det){ ?> — <?= pedido.pago.det ?><? } ?></div>
      <div><b>Transporte:</b> <?= (pedido.transporte.modo || '—') ?> · <?= (pedido.transporte.pref || '—') ?><? if (pedido.transporte.det){ ?> — <?= pedido.transporte.det ?><? } ?></div>
      <? if (pedido.oc.num || pedido.oc.fecha) { ?>
        <div><b>Orden de compra:</b> <?= pedido.oc.num || '—' ?><? if (pedido.oc.fecha){ ?> · <?= pedido.oc.fecha ?><? } ?></div>
      <? } ?>
    </div>
  </div>

  <div class="card">
    <h2>Ítems del pedido</h2>
    <? if ((pedido.items||[]).length===0) { ?>
      <p class="small">Aún no hay ítems disponibles.</p>
    <? } else { ?>
      <table class="table">
        <thead>
          <tr>
            <th>#</th><th>Producto</th><th>Color</th><th style="text-align:right">Cant.</th>
            <th>Impresión</th><th>Tiempo</th><th>Entrega</th>
          </tr>
        </thead>
        <tbody>
          <? pedido.items.forEach(function(it){ ?>
            <tr>
              <td style="text-align:center"><?= it.n ?></td>
              <td><?= it.producto ?></td>
              <td><?= it.color ?></td>
              <td style="text-align:right"><?= it.cantidad ?></td>
              <td>
                <?= it.metodo ?>
                <div class="small">
                  <? if (it.colores) { ?>Colores: <?= it.colores ?> · <? } ?>
                  <? if (it.grabadoNombres) { ?>Nombres personalizados<? if (it.grabadoUrl){ ?> (<?= it.grabadoUrl ?>)<? } ?><? } ?>
                  <? if (it.notas){ ?> · Notas: <?= it.notas ?><? } ?>
                </div>
                <? if ((it.fileUrls||[]).length){ ?>
                  <div class="small">
                    <? it.fileUrls.forEach(function(u,idx){ ?>
                      <div>Arte (<?= idx+1 ?>): <a href="<?= u ?>" target="_blank" rel="noopener"><?= u ?></a></div>
                    <? }) ?>
                  </div>
                <? } ?>
              </td>
              <td><?= it.tiempo || '—' ?></td>
              <td><?= it.fecha  || '—' ?></td>
            </tr>
          <? }) ?>
        </tbody>
      </table>
    <? } ?>
  </div>

  <div class="card">
    <h2>Archivos del boceto (PDF)</h2>
    <? if ((pedido.pdfs||[]).length === 0) { ?>
      <p class="small">Aún no hay archivos disponibles.</p>
    <? } else { ?>
      <? pedido.pdfs.forEach(function(u, i){ ?>
        <div class="small">PDF <?= (i+1) ?>: <a href="<?= u ?>" target="_blank" rel="noopener"><?= u ?></a></div>
      <? }) ?>
    <? } ?>
  </div>

  <div class="card">
    <h2>¿Cómo deseas proceder?</h2>
    <form method="post" enctype="multipart/form-data" action="<?= postUrl ?>">
      <input type="hidden" name="kind" value="client_reply" />
      <input type="hidden" name="token" value="<?= pedido.token ?>" />
      <input type="hidden" name="pedido" value="<?= pedido.nro ?>" />

      <div class="row">
        <div>
          <button class="btn" name="accion" value="aprobar" type="submit">✅ Aprobar bocetos</button>
        </div>
        <div>
          <button class="btn outline" name="accion" value="cambios" type="submit">✏️ Solicitar cambios</button>
        </div>
      </div>

      <div style="margin-top:14px">
        <label for="comentarios">Comentarios (opcional):</label>
        <textarea id="comentarios" name="comentarios" placeholder="Escribe aquí comentarios, indicaciones o correcciones..."></textarea>
      </div>

      <div style="margin-top:10px">
        <label for="adjunto">Adjuntar archivo con anotaciones (opcional, PDF/imagen):</label>
        <input id="adjunto" name="adjunto" type="file" accept=".pdf,image/*" />
        <div class="small">El archivo irá seguro a Merchi y quedará enlazado a tu pedido.</div>
      </div>

      <div style="margin-top:14px">
        <button class="btn" type="submit">Enviar respuesta</button>
      </div>
    </form>
  </div>

  <div class="card">
    <div class="small">Soporte Merchi · dudas: <a href="mailto:produccion@merchi.cl">produccion@merchi.cl</a></div>
  </div>
</div>
</body>
</html>
